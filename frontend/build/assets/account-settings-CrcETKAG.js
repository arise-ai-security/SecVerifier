import{w as ye}from"./with-props-CpQmc7fE.js";import{o as e,p as T,t as Ce}from"./chunk-BAXFHI7N-C1aCn8M0.js";import{I as n}from"./declaration-Be1JuYcO.js";import{B as A}from"./brand-button-Chc-dr4s.js";import{u as Me,o as ie,e as je,b as Ge,a as ke,M as ve,K as L,H as Ue,h as we}from"./handle-capture-consent-Ds16U-94.js";import{S as I}from"./settings-dropdown-input-BaocZbxC.js";import{S as E}from"./settings-input-CZ580Raz.js";import{c as te}from"./utils-CsA7xLXy.js";import{L as Fe}from"./loading-spinner-CRauKqNm.js";import{u as $e}from"./use-config-D8tLtqcY.js";import{D as O,u as Be}from"./use-settings-TDHcUM0x.js";import{A as se}from"./index-Ce6tqe-R.js";import{r as Ke}from"./retrieve-axios-error-message-CoJTAmT2.js";import{d as De,a as Pe}from"./custom-toast-handlers-xKzFdWix.js";import{u as Ye}from"./auth-context-QvFmluSo.js";import{u as He}from"./useTranslation-D6EhfAhY.js";import"./mutation-BLcRjgsX.js";import"./open-hands-axios-DmXtiBSx.js";import"./QueryClientProvider-DzZUh9st.js";import"./open-hands--YlJ3f3i.js";import"./chunk-DNIGSRME-C0GitgCW.js";import"./module-CmhJwC8X.js";import"./optional-tag-xyWOVPWY.js";import"./preload-helper-ckwbz45p.js";import"./index-BP-02qgu.js";import"./i18nInstance-CHFDjdcJ.js";import"./index-CO93yzRA.js";function ze({isToggled:t}){return e.jsx("div",{className:te("w-12 h-6 rounded-xl flex items-center p-1.5 cursor-pointer",t&&"justify-end bg-primary",!t&&"justify-start bg-base-secondary border border-tertiary-light"),children:e.jsx("div",{className:te("w-3 h-3 rounded-xl",t?"bg-base-secondary":"bg-tertiary-light")})})}function g({children:t,testId:s,name:d,onToggle:r,defaultIsToggled:u,isBeta:i}){const[o,b]=T.useState(u??!1),f=p=>{b(p),r==null||r(p)};return e.jsxs("label",{className:"flex items-center gap-2 w-fit",children:[e.jsx("input",{hidden:!0,"data-testid":s,name:d,type:"checkbox",onChange:p=>f(p.target.checked),defaultChecked:u}),e.jsx(ze,{isToggled:o}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm",children:t}),i&&e.jsx("span",{className:"text-[11px] leading-4 text-[#0D0F11] font-[500] tracking-tighter bg-primary px-1 rounded-full",children:"Beta"})]})]})}const Ve=()=>{const{mutateAsync:t}=Me();return{handleLogout:async()=>{await t()}}},Ze=t=>!!t.LLM_BASE_URL||t.AGENT!==O.AGENT||t.REMOTE_RUNTIME_RESOURCE_FACTOR!==O.REMOTE_RUNTIME_RESOURCE_FACTOR||t.CONFIRMATION_MODE||!!t.SECURITY_ANALYZER,We=(t,s)=>{if(!s)return!1;const d=ie(t),{provider:r,model:u}=je(s);return!(r in d&&d[r].models.includes(u))},ne={github:"github",gitlab:"gitlab"},ae=[{key:"1",label:"Standard"},{key:"2",label:"Enhanced"},{key:"4",label:"Premium"}];function qe(){var G;const{t}=He(),{data:s,isFetching:d,isFetched:r,isSuccess:u}=Be(),{data:i}=$e(),{data:o,isFetching:b,isSuccess:f}=Ge(),{mutate:p}=ke(),{handleLogout:oe}=Ve(),{providerTokensSet:R,providersAreSet:le}=Ye(),re=d||b,ce=u&&f,N=(i==null?void 0:i.APP_MODE)==="saas",l=(i==null?void 0:i.FEATURE_FLAGS.HIDE_LLM_SETTINGS)&&N,de=()=>l?!0:ce?We(o.models,s.LLM_MODEL)||Ze({...s}):!1,ue=!!(i!=null&&i.APP_SLUG),h=R.includes(ne.github)||!1,y=R.includes(ne.gitlab)||!1,x=s==null?void 0:s.LLM_API_KEY_SET,pe=s==null?void 0:s.USER_CONSENTS_TO_ANALYTICS,m=de(),me=ie((o==null?void 0:o.models)||[]),[c,_]=T.useState(m?"advanced":"basic"),[C,M]=T.useState(!!(s!=null&&s.SECURITY_ANALYZER)),j=T.useRef(null),Se=async a=>{var $,B,K,D,P,Y,H,z,V,Z,W,q,J,Q,X,ee;const ge=($=a.get("language-input"))==null?void 0:$.toString(),Te=(B=se.find(({label:S})=>S===ge))==null?void 0:B.value,Ne=(K=a.get("llm-provider-input"))==null?void 0:K.toString(),he=(D=a.get("llm-model-input"))==null?void 0:D.toString(),xe=`${Ne}/${he}`.toLowerCase(),Ie=(P=a.get("llm-custom-model-input"))==null?void 0:P.toString(),be=(Y=a.get("runtime-settings-input"))==null?void 0:Y.toString(),k=(H=ae.find(({label:S})=>S===be))==null?void 0:H.key,v=((z=a.get("enable-analytics-switch"))==null?void 0:z.toString())==="on",fe=((V=a.get("enable-memory-condenser-switch"))==null?void 0:V.toString())==="on",_e=((Z=a.get("enable-sound-notifications-switch"))==null?void 0:Z.toString())==="on",Ae=((W=a.get("base-url-input"))==null?void 0:W.toString().trim())||"",U=((q=a.get("llm-api-key-input"))==null?void 0:q.toString())||"",Le=U===""&&x?void 0:U,w=(J=a.get("github-token-input"))==null?void 0:J.toString(),F=(Q=a.get("gitlab-token-input"))==null?void 0:Q.toString(),Oe={provider_tokens:w||F?{github:w||"",gitlab:F||""}:void 0,LANGUAGE:Te,user_consents_to_analytics:v,ENABLE_DEFAULT_CONDENSER:fe,ENABLE_SOUND_NOTIFICATIONS:_e,LLM_MODEL:l?void 0:Ie||xe,LLM_BASE_URL:l?void 0:Ae,llm_api_key:l?void 0:Le,AGENT:(X=a.get("agent-input"))==null?void 0:X.toString(),SECURITY_ANALYZER:((ee=a.get("security-analyzer-input"))==null?void 0:ee.toString())||"",REMOTE_RUNTIME_RESOURCE_FACTOR:k!==null?Number(k):O.REMOTE_RUNTIME_RESOURCE_FACTOR,CONFIRMATION_MODE:C};p(Oe,{onSuccess:()=>{we(v),Pe(t(n.SETTINGS$SAVED)),_(m?"advanced":"basic")},onError:S=>{const Re=Ke(S);De(Re||t(n.ERROR$GENERIC))}})};if(T.useEffect(()=>{_(m?"advanced":"basic")},[m]),r&&!s)return e.jsx("div",{children:"Failed to fetch settings. Please try reloading."});const Ee=a=>{_(a?"advanced":"basic"),a||M(!!(s!=null&&s.SECURITY_ANALYZER))};return re||!s?e.jsx("div",{className:"flex grow p-4",children:e.jsx(Fe,{size:"large"})}):e.jsxs(e.Fragment,{children:[e.jsx("form",{"data-testid":"account-settings-form",ref:j,action:Se,className:"flex flex-col grow overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-12 px-11 py-9",children:[!l&&e.jsxs("section",{"data-testid":"llm-settings-section",className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-7",children:[e.jsx("h2",{className:"text-[28px] leading-8 tracking-[-0.02em] font-bold",children:t(n.SETTINGS$LLM_SETTINGS)}),!l&&e.jsx(g,{testId:"advanced-settings-switch",defaultIsToggled:m,onToggle:Ee,children:t(n.SETTINGS$ADVANCED)})]}),c==="basic"&&!l&&e.jsx(ve,{models:me,currentModel:s.LLM_MODEL}),c==="advanced"&&!l&&e.jsx(E,{testId:"llm-custom-model-input",name:"llm-custom-model-input",label:t(n.SETTINGS$CUSTOM_MODEL),defaultValue:s.LLM_MODEL,placeholder:"anthropic/claude-3-5-sonnet-20241022",type:"text",className:"w-[680px]"}),c==="advanced"&&!l&&e.jsx(E,{testId:"base-url-input",name:"base-url-input",label:t(n.SETTINGS$BASE_URL),defaultValue:s.LLM_BASE_URL,placeholder:"https://api.openai.com",type:"text",className:"w-[680px]"}),!l&&e.jsx(E,{testId:"llm-api-key-input",name:"llm-api-key-input",label:t(n.SETTINGS_FORM$API_KEY),type:"password",className:"w-[680px]",placeholder:x?"<hidden>":"",startContent:x&&e.jsx(L,{isSet:x})}),!l&&e.jsx(Ue,{testId:"llm-api-key-help-anchor",text:t(n.SETTINGS$DONT_KNOW_API_KEY),linkText:t(n.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/modules/usage/installation#getting-an-api-key"}),c==="advanced"&&e.jsx(I,{testId:"agent-input",name:"agent-input",label:t(n.SETTINGS$AGENT),items:(o==null?void 0:o.agents.map(a=>({key:a,label:a})))||[],wrapperClassName:"w-[680px]",defaultSelectedKey:s.AGENT,isClearable:!1}),N&&c==="advanced"&&e.jsx(I,{testId:"runtime-settings-input",name:"runtime-settings-input",label:e.jsxs(e.Fragment,{children:[t(n.SETTINGS$RUNTIME_SETTINGS),e.jsx("a",{href:"mailto:contact@all-hands.dev",children:t(n.SETTINGS$GET_IN_TOUCH)}),")"]}),items:ae,defaultSelectedKey:(G=s.REMOTE_RUNTIME_RESOURCE_FACTOR)==null?void 0:G.toString(),isDisabled:!0,isClearable:!1}),c==="advanced"&&e.jsx(g,{testId:"enable-confirmation-mode-switch",onToggle:M,defaultIsToggled:!!s.CONFIRMATION_MODE,isBeta:!0,children:t(n.SETTINGS$CONFIRMATION_MODE)}),c==="advanced"&&e.jsx(g,{testId:"enable-memory-condenser-switch",name:"enable-memory-condenser-switch",defaultIsToggled:!!s.ENABLE_DEFAULT_CONDENSER,children:t(n.SETTINGS$ENABLE_MEMORY_CONDENSATION)}),c==="advanced"&&C&&e.jsx("div",{children:e.jsx(I,{testId:"security-analyzer-input",name:"security-analyzer-input",label:t(n.SETTINGS$SECURITY_ANALYZER),items:(o==null?void 0:o.securityAnalyzers.map(a=>({key:a,label:a})))||[],defaultSelectedKey:s.SECURITY_ANALYZER,isClearable:!0,showOptionalTag:!0})})]}),e.jsxs("section",{className:"flex flex-col gap-6",children:[e.jsx("h2",{className:"text-[28px] leading-8 tracking-[-0.02em] font-bold",children:t(n.SETTINGS$GIT_SETTINGS)}),N&&ue&&e.jsx(Ce,{to:`https://github.com/apps/${i.APP_SLUG}/installations/new`,target:"_blank",rel:"noreferrer noopener",children:e.jsx(A,{type:"button",variant:"secondary",children:t(n.GITHUB$CONFIGURE_REPOS)})}),!N&&e.jsxs(e.Fragment,{children:[e.jsx(E,{testId:"github-token-input",name:"github-token-input",label:t(n.GITHUB$TOKEN_LABEL),type:"password",className:"w-[680px]",startContent:h&&e.jsx(L,{isSet:!!h}),placeholder:h?"<hidden>":""}),e.jsxs("p",{"data-testid":"github-token-help-anchor",className:"text-xs",children:[" ",t(n.GITHUB$GET_TOKEN)," ",e.jsxs("b",{children:[" ",e.jsx("a",{href:"https://github.com/settings/tokens/new?description=openhands-app&scopes=repo,user,workflow",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer",children:"GitHub"})," "]}),t(n.COMMON$HERE)," ",e.jsx("b",{children:e.jsx("a",{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer",children:t(n.COMMON$CLICK_FOR_INSTRUCTIONS)})}),"."]}),e.jsx(E,{testId:"gitlab-token-input",name:"gitlab-token-input",label:t(n.GITLAB$TOKEN_LABEL),type:"password",className:"w-[680px]",startContent:y&&e.jsx(L,{isSet:!!y}),placeholder:h?"<hidden>":""}),e.jsxs("p",{"data-testid":"gitlab-token-help-anchor",className:"text-xs",children:[" ",t(n.GITLAB$GET_TOKEN)," ",e.jsxs("b",{children:[" ",e.jsx("a",{href:"https://gitlab.com/-/user_settings/personal_access_tokens?name=openhands-app&scopes=api,read_user,read_repository,write_repository",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer",children:"GitLab"})," "]}),t(n.GITLAB$OR_SEE)," ",e.jsx("b",{children:e.jsx("a",{href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer",children:t(n.COMMON$DOCUMENTATION)})}),"."]}),e.jsx(A,{type:"button",variant:"secondary",onClick:oe,isDisabled:!le,children:"Disconnect Tokens"})]})]}),e.jsxs("section",{className:"flex flex-col gap-6",children:[e.jsx("h2",{className:"text-[28px] leading-8 tracking-[-0.02em] font-bold",children:t(n.ACCOUNT_SETTINGS$ADDITIONAL_SETTINGS)}),e.jsx(I,{testId:"language-input",name:"language-input",label:t(n.SETTINGS$LANGUAGE),items:se.map(a=>({key:a.value,label:a.label})),defaultSelectedKey:s.LANGUAGE,wrapperClassName:"w-[680px]",isClearable:!1}),e.jsx(g,{testId:"enable-analytics-switch",name:"enable-analytics-switch",defaultIsToggled:!!pe,children:t(n.ANALYTICS$ENABLE)}),e.jsx(g,{testId:"enable-sound-notifications-switch",name:"enable-sound-notifications-switch",defaultIsToggled:!!s.ENABLE_SOUND_NOTIFICATIONS,children:t(n.SETTINGS$SOUND_NOTIFICATIONS)})]})]})}),e.jsx("footer",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:e.jsx(A,{type:"button",variant:"primary",onClick:()=>{var a;(a=j.current)==null||a.requestSubmit()},children:t(n.BUTTON$SAVE)})})]})}const Ot=ye(qe);export{Ot as default};
