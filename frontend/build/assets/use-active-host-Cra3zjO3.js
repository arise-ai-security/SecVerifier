var L=i=>{throw TypeError(i)};var H=(i,e,s)=>e.has(i)||L("Cannot "+s);var n=(i,e,s)=>(H(i,e,"read from private field"),s?s.call(i):e.get(i)),b=(i,e,s)=>e.has(i)?L("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),l=(i,e,s,t)=>(H(i,e,"write to private field"),t?t.call(i,s):e.set(i,s),s),y=(i,e,s)=>(H(i,e,"access private method"),s);import{r as w,p as z}from"./chunk-BAXFHI7N-C1aCn8M0.js";import{S as V,n as M,g as $,e as N,y as J,z as X,A as Y,B as Z,C as W,v as ee,D as U,E as _,F as se,G as te,u as re,H as ie,j as ne}from"./open-hands-axios-DmXtiBSx.js";import{u as oe}from"./QueryClientProvider-DzZUh9st.js";import{a as ue}from"./react-redux-bUW3E-1D.js";import{R as ae}from"./agent-state-u5yf9HVO.js";import{u as ce}from"./conversation-context-C7l2I9sq.js";function j(i,e){return i.filter(s=>!e.includes(s))}function he(i,e,s){const t=i.slice(0);return t[e]=s,t}var g,f,R,E,d,O,C,S,q,h,x,k,I,T,B,K,le=(K=class extends V{constructor(e,s,t){super();b(this,h);b(this,g);b(this,f);b(this,R);b(this,E);b(this,d);b(this,O);b(this,C);b(this,S);b(this,q,[]);l(this,g,e),l(this,E,t),l(this,R,[]),l(this,d,[]),l(this,f,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,d).forEach(e=>{e.subscribe(s=>{y(this,h,T).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,d).forEach(e=>{e.destroy()})}setQueries(e,s){l(this,R,e),l(this,E,s),M.batch(()=>{const t=n(this,d),o=y(this,h,I).call(this,n(this,R));l(this,q,o),o.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions));const r=o.map(a=>a.observer),c=r.map(a=>a.getCurrentResult()),u=r.some((a,Q)=>a!==t[Q]);t.length===r.length&&!u||(l(this,d,r),l(this,f,c),this.hasListeners()&&(j(t,r).forEach(a=>{a.destroy()}),j(r,t).forEach(a=>{a.subscribe(Q=>{y(this,h,T).call(this,a,Q)})}),y(this,h,B).call(this)))})}getCurrentResult(){return n(this,f)}getQueries(){return n(this,d).map(e=>e.getCurrentQuery())}getObservers(){return n(this,d)}getOptimisticResult(e,s){const t=y(this,h,I).call(this,e),o=t.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[o,r=>y(this,h,k).call(this,r??o,s),()=>y(this,h,x).call(this,o,t)]}},g=new WeakMap,f=new WeakMap,R=new WeakMap,E=new WeakMap,d=new WeakMap,O=new WeakMap,C=new WeakMap,S=new WeakMap,q=new WeakMap,h=new WeakSet,x=function(e,s){return s.map((t,o)=>{const r=e[o];return t.defaultedQueryOptions.notifyOnChangeProps?r:t.observer.trackResult(r,c=>{s.forEach(u=>{u.observer.trackProp(c)})})})},k=function(e,s){return s?((!n(this,O)||n(this,f)!==n(this,S)||s!==n(this,C))&&(l(this,C,s),l(this,S,n(this,f)),l(this,O,$(n(this,O),s(e)))),n(this,O)):e},I=function(e){const s=new Map(n(this,d).map(o=>[o.options.queryHash,o])),t=[];return e.forEach(o=>{const r=n(this,g).defaultQueryOptions(o),c=s.get(r.queryHash);c?t.push({defaultedQueryOptions:r,observer:c}):t.push({defaultedQueryOptions:r,observer:new N(n(this,g),r)})}),t},T=function(e,s){const t=n(this,d).indexOf(e);t!==-1&&(l(this,f,he(n(this,f),t,s)),y(this,h,B).call(this))},B=function(){var e;if(this.hasListeners()){const s=n(this,O),t=y(this,h,x).call(this,n(this,f),n(this,q)),o=y(this,h,k).call(this,t,(e=n(this,E))==null?void 0:e.combine);s!==o&&M.batch(()=>{this.listeners.forEach(r=>{r(n(this,f))})})}},K);function pe({queries:i,...e},s){const t=oe(s),o=J(),r=X(),c=w.useMemo(()=>i.map(p=>{const v=t.defaultQueryOptions(p);return v._optimisticResults=o?"isRestoring":"optimistic",v}),[i,t,o]);c.forEach(p=>{Y(p),Z(p,r)}),W(r);const[u]=w.useState(()=>new le(t,c,e)),[a,Q,G]=u.getOptimisticResult(c,e.combine),P=!o&&e.subscribed!==!1;w.useSyncExternalStore(w.useCallback(p=>P?u.subscribe(M.batchCalls(p)):ee,[u,P]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),w.useEffect(()=>{u.setQueries(c,e)},[c,e,u]);const D=a.some((p,v)=>U(c[v],p))?a.flatMap((p,v)=>{const m=c[v];if(m){const F=new N(t,m);if(U(m,p))return _(m,F,r);se(p,o)&&_(m,F,r)}return[]}):[];if(D.length>0)throw Promise.all(D);const A=a.find((p,v)=>{const m=c[v];return m&&te({result:p,errorResetBoundary:r,throwOnError:m.throwOnError,query:t.getQueryCache().get(m.queryHash),suspense:m.suspense})});if(A!=null&&A.error)throw A.error;return Q(G())}const Re=()=>{const{curAgentState:i}=ue(u=>u.agent),[e,s]=z.useState(null),{conversationId:t}=ce(),{data:o}=re({queryKey:[t,"hosts"],queryFn:async()=>{const u=await ne.get(`/api/conversations/${t}/web-hosts`);return{hosts:Object.keys(u.data.hosts)}},enabled:!ae.includes(i),initialData:{hosts:[]},meta:{disableToast:!0}}),c=pe({queries:o.hosts.map(u=>({queryKey:[t,"hosts",u],queryFn:async()=>{try{return await ie.get(u),u}catch{return""}},refetchInterval:3e3,meta:{disableToast:!0}}))}).map(u=>u.data);return z.useEffect(()=>{const u=c.find(a=>a);s(u||"")},[c]),{activeHost:e}};export{Re as u};
