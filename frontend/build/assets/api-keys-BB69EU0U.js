import{w as P}from"./with-props-CpQmc7fE.js";import{o as e,r as u}from"./chunk-BAXFHI7N-C1aCn8M0.js";import{I as s}from"./declaration-Be1JuYcO.js";import{u as _,B as d}from"./brand-button-Chc-dr4s.js";import{L as T}from"./loading-spinner-CRauKqNm.js";import{d as y,a as f}from"./custom-toast-handlers-xKzFdWix.js";import{S as D}from"./settings-input-CZ580Raz.js";import{M as v}from"./modal-backdrop-BkQnjy5a.js";import{u as g}from"./QueryClientProvider-DzZUh9st.js";import{j as h,u as M}from"./open-hands-axios-DmXtiBSx.js";import{u as G}from"./use-config-D8tLtqcY.js";import{u as L}from"./auth-context-QvFmluSo.js";import{u as E}from"./useTranslation-D6EhfAhY.js";import"./mutation-BLcRjgsX.js";import"./utils-CsA7xLXy.js";import"./index-CO93yzRA.js";import"./optional-tag-xyWOVPWY.js";import"./open-hands--YlJ3f3i.js";import"./i18nInstance-CHFDjdcJ.js";function A({isOpen:n,title:t,width:r="500px",children:a,footer:i}){return n?e.jsx(v,{children:e.jsxs("div",{className:"bg-base-secondary p-6 rounded-xl flex flex-col gap-4 border border-tertiary",style:{width:r},children:[e.jsx("h3",{className:"text-xl font-bold",children:t}),a,e.jsx("div",{className:"w-full flex gap-2 mt-2",children:i})]})}):null}class j{static async getApiKeys(){const{data:t}=await h.get("/api/keys");return Array.isArray(t)?t:[]}static async createApiKey(t){const{data:r}=await h.post("/api/keys",{name:t});return r}static async deleteApiKey(t){await h.delete(`/api/keys/${t}`)}}const S="api-keys";function Y(){const{providersAreSet:n}=L(),{data:t}=G();return M({queryKey:[S],enabled:n&&(t==null?void 0:t.APP_MODE)==="saas",queryFn:async()=>{const r=await j.getApiKeys();return Array.isArray(r)?r:[]},staleTime:1e3*60*5,gcTime:1e3*60*15})}function k(){const n=g();return _({mutationFn:async t=>j.createApiKey(t),onSuccess:()=>{n.invalidateQueries({queryKey:[S]})}})}function B({isOpen:n,onClose:t,onKeyCreated:r}){const{t:a}=E(),[i,l]=u.useState(""),c=k(),p=async()=>{if(!i.trim()){y(a(s.ERROR$REQUIRED_FIELD));return}try{const m=await c.mutateAsync(i);r(m),f(a(s.SETTINGS$API_KEY_CREATED)),l("")}catch{y(a(s.ERROR$GENERIC))}},N=()=>{l(""),t()},x=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"primary",className:"grow",onClick:p,isDisabled:c.isPending||!i.trim(),children:c.isPending?e.jsx(T,{size:"small"}):a(s.BUTTON$CREATE)}),e.jsx(d,{type:"button",variant:"secondary",className:"grow",onClick:N,isDisabled:c.isPending,children:a(s.BUTTON$CANCEL)})]});return e.jsx(A,{isOpen:n,title:a(s.SETTINGS$CREATE_API_KEY),footer:x,children:e.jsxs("div",{"data-testid":"create-api-key-modal",children:[e.jsx("p",{className:"text-sm text-gray-300",children:a(s.SETTINGS$CREATE_API_KEY_DESCRIPTION)}),e.jsx(D,{testId:"api-key-name-input",label:a(s.SETTINGS$NAME),placeholder:a(s.SETTINGS$API_KEY_NAME_PLACEHOLDER),value:i,onChange:m=>l(m),className:"w-full mt-4",type:"text"})]})})}function F(){const n=g();return _({mutationFn:async t=>{await j.deleteApiKey(t)},onSuccess:()=>{n.invalidateQueries({queryKey:[S]})}})}function U({isOpen:n,keyToDelete:t,onClose:r}){const{t:a}=E(),i=F(),l=async()=>{if(t)try{await i.mutateAsync(t.id),f(a(s.SETTINGS$API_KEY_DELETED)),r()}catch{y(a(s.ERROR$GENERIC))}};if(!t)return null;const c=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"danger",className:"grow",onClick:l,isDisabled:i.isPending,children:i.isPending?e.jsx(T,{size:"small"}):a(s.BUTTON$DELETE)}),e.jsx(d,{type:"button",variant:"secondary",className:"grow",onClick:r,isDisabled:i.isPending,children:a(s.BUTTON$CANCEL)})]});return e.jsx(A,{isOpen:n&&!!t,title:a(s.SETTINGS$DELETE_API_KEY),footer:c,children:e.jsx("div",{"data-testid":"delete-api-key-modal",children:e.jsx("p",{className:"text-sm",children:a(s.SETTINGS$DELETE_API_KEY_CONFIRMATION,{name:t.name})})})})}function q({isOpen:n,newlyCreatedKey:t,onClose:r}){const{t:a}=E(),i=()=>{t&&(navigator.clipboard.writeText(t.key),f(a(s.SETTINGS$API_KEY_COPIED)))};if(!t)return null;const l=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"primary",onClick:i,children:a(s.BUTTON$COPY_TO_CLIPBOARD)}),e.jsx(d,{type:"button",variant:"secondary",onClick:r,children:a(s.BUTTON$CLOSE)})]});return e.jsx(A,{isOpen:n&&!!t,title:a(s.SETTINGS$API_KEY_CREATED),width:"600px",footer:l,children:e.jsxs("div",{"data-testid":"new-api-key-modal",children:[e.jsx("p",{className:"text-sm",children:a(s.SETTINGS$API_KEY_WARNING)}),e.jsx("div",{className:"bg-base-tertiary p-4 rounded-md font-mono text-sm break-all mt-4",children:t.key})]})})}function Q(){const{t:n}=E(),{data:t=[],isLoading:r,error:a}=Y(),[i,l]=u.useState(!1),[c,p]=u.useState(!1),[N,x]=u.useState(null),[m,C]=u.useState(null),[b,I]=u.useState(!1);a&&y(n(s.ERROR$GENERIC));const O=o=>{C(o),l(!1),I(!0)},R=()=>{l(!1)},w=()=>{p(!1),x(null)},$=()=>{I(!1),C(null)},K=o=>o?new Date(o).toLocaleString():"Never";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(d,{type:"button",variant:"primary",onClick:()=>l(!0),children:n(s.SETTINGS$CREATE_API_KEY)})}),e.jsx("p",{className:"text-sm text-gray-300",children:n(s.SETTINGS$API_KEYS_DESCRIPTION)}),r&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(T,{size:"large"})}),!r&&Array.isArray(t)&&t.length>0&&e.jsx("div",{className:"border border-tertiary rounded-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-base-tertiary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$NAME)}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$CREATED_AT)}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$LAST_USED)}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:n(s.SETTINGS$ACTIONS)})]})}),e.jsx("tbody",{children:t.map(o=>e.jsxs("tr",{className:"border-t border-tertiary",children:[e.jsx("td",{className:"p-3 text-sm",children:o.name}),e.jsx("td",{className:"p-3 text-sm",children:K(o.created_at)}),e.jsx("td",{className:"p-3 text-sm",children:K(o.last_used_at)}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{type:"button",className:"underline",onClick:()=>{x(o),p(!0)},children:n(s.BUTTON$DELETE)})})]},o.id))})]})})]}),e.jsx(B,{isOpen:i,onClose:R,onKeyCreated:O}),e.jsx(U,{isOpen:c,keyToDelete:N,onClose:w}),e.jsx(q,{isOpen:b,newlyCreatedKey:m,onClose:$})]})}function z(){return e.jsx("div",{className:"flex flex-col grow overflow-auto p-11",children:e.jsx(Q,{})})}const pe=P(z);export{pe as default};
