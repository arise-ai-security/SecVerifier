import{R as f,i as v,d as g,j as C,k as m,l as b,t as w,c as S,n as U,m as l,e as F,p as k,o as r,A as $}from"./open-hands-axios-BHmDa7Dt.js";var D=class extends f{#n;#a;#e;#r;#t;#o;#i;constructor(a){super(),this.#i=!1,this.#o=a.defaultOptions,this.setOptions(a.options),this.observers=[],this.#r=a.client,this.#e=this.#r.getQueryCache(),this.queryKey=a.queryKey,this.queryHash=a.queryHash,this.#n=_(this.options),this.state=a.state??this.#n,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#t?.promise}setOptions(a){this.options={...this.#o,...a},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#e.remove(this)}setData(a,t){const e=v(this.state.data,a,this.options);return this.#s({data:e,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),e}setState(a,t){this.#s({type:"setState",state:a,setStateOptions:t})}cancel(a){const t=this.#t?.promise;return this.#t?.cancel(a),t?t.then(g).catch(g):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#n)}isActive(){return this.observers.some(a=>C(a.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===m||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(a=>b(a.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(a=>a.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(a=0){return this.state.data===void 0?!0:a==="static"?!1:this.state.isInvalidated?!0:!w(this.state.dataUpdatedAt,a)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#t?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#t?.continue()}addObserver(a){this.observers.includes(a)||(this.observers.push(a),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",query:this,observer:a}))}removeObserver(a){this.observers.includes(a)&&(this.observers=this.observers.filter(t=>t!==a),this.observers.length||(this.#t&&(this.#i?this.#t.cancel({revert:!0}):this.#t.cancelRetry()),this.scheduleGc()),this.#e.notify({type:"observerRemoved",query:this,observer:a}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(a,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#t)return this.#t.continueRetry(),this.#t.promise}if(a&&this.setOptions(a),!this.options.queryFn){const n=this.observers.find(h=>h.options.queryFn);n&&this.setOptions(n.options)}const e=new AbortController,s=n=>{Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(this.#i=!0,e.signal)})},i=()=>{const n=F(this.options,t),d=(()=>{const p={client:this.#r,queryKey:this.queryKey,meta:this.meta};return s(p),p})();return this.#i=!1,this.options.persister?this.options.persister(n,d,this):n(d)},o=(()=>{const n={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:i};return s(n),n})();this.options.behavior?.onFetch(o,this),this.#a=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&this.#s({type:"fetch",meta:o.fetchOptions?.meta});const c=n=>{l(n)&&n.silent||this.#s({type:"error",error:n}),l(n)||(this.#e.config.onError?.(n,this),this.#e.config.onSettled?.(this.state.data,n,this)),this.scheduleGc()};return this.#t=S({initialPromise:t?.initialPromise,fn:o.fetchFn,abort:e.abort.bind(e),onSuccess:n=>{if(n===void 0){c(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(n)}catch(h){c(h);return}this.#e.config.onSuccess?.(n,this),this.#e.config.onSettled?.(n,this.state.error,this),this.scheduleGc()},onError:c,onFail:(n,h)=>{this.#s({type:"failed",failureCount:n,error:h})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}),this.#t.start()}#s(a){const t=e=>{switch(a.type){case"failed":return{...e,fetchFailureCount:a.failureCount,fetchFailureReason:a.error};case"pause":return{...e,fetchStatus:"paused"};case"continue":return{...e,fetchStatus:"fetching"};case"fetch":return{...e,...R(e.data,this.options),fetchMeta:a.meta??null};case"success":return this.#a=void 0,{...e,data:a.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:a.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!a.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=a.error;return l(s)&&s.revert&&this.#a?{...this.#a,fetchStatus:"idle"}:{...e,error:s,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...e,isInvalidated:!0};case"setState":return{...e,...a.state}}};this.state=t(this.state),U.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#e.notify({query:this,type:"updated",action:a})})}};function R(a,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:k(t.networkMode)?"fetching":"paused",...a===void 0&&{error:null,status:"pending"}}}function _(a){const t=typeof a.initialData=="function"?a.initialData():a.initialData,e=t!==void 0,s=e?typeof a.initialDataUpdatedAt=="function"?a.initialDataUpdatedAt():a.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}const y=a=>{const t=/<[^>]*[?&]page=(\d+)(?:&[^>]*)?>; rel="next"/,e=a.match(t);return e?parseInt(e[1],10):null};class H{static currentConversation=null;static getCurrentConversation(){return this.currentConversation}static setCurrentConversation(t){this.currentConversation=t}static getConversationUrl(t){return this.currentConversation?.conversation_id===t&&this.currentConversation.url?this.currentConversation.url:`/api/conversations/${t}`}static async getModels(){const{data:t}=await r.get("/api/options/models");return t}static async getAgents(){const{data:t}=await r.get("/api/options/agents");return t}static async getSecurityAnalyzers(){const{data:t}=await r.get("/api/options/security-analyzers");return t}static async getConfig(){const{data:t}=await r.get("/api/options/config");return t}static getConversationHeaders(){const t=new $,e=this.currentConversation?.session_api_key;return e&&t.set("X-Session-API-Key",e),t}static async submitFeedback(t,e){const s=`/api/conversations/${t}/submit-feedback`,{data:i}=await r.post(s,e);return i}static async submitConversationFeedback(t,e,s,i){const u="/feedback/conversation",o={conversation_id:t,event_id:s,rating:e,reason:i,metadata:{source:"likert-scale"}},{data:c}=await r.post(u,o);return c}static async checkFeedbackExists(t,e){try{const s=`/feedback/conversation/${t}/${e}`,{data:i}=await r.get(s);return i}catch{return{exists:!1}}}static async getBatchFeedback(t){const e=`/feedback/conversation/${t}/batch`,{data:s}=await r.get(e);return s}static async authenticate(t){return t==="oss"||await r.post("/api/authenticate"),!0}static async getWorkspaceZip(t){const e=`${this.getConversationUrl(t)}/zip-directory`;return(await r.get(e,{responseType:"blob",headers:this.getConversationHeaders()})).data}static async getWebHosts(t){const e=`${this.getConversationUrl(t)}/web-hosts`,s=await r.get(e,{headers:this.getConversationHeaders()});return Object.keys(s.data.hosts)}static async getGitHubAccessToken(t){const{data:e}=await r.post("/api/keycloak/callback",{code:t});return e}static async getVSCodeUrl(t){const e=`${this.getConversationUrl(t)}/vscode-url`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getRuntimeId(t){const e=`${this.getConversationUrl(t)}/config`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getUserConversations(t=20,e){const s=new URLSearchParams;s.append("limit",t.toString()),e&&s.append("page_id",e);const{data:i}=await r.get(`/api/conversations?${s.toString()}`);return i}static async searchConversations(t,e,s=100){const i=new URLSearchParams;i.append("limit",s.toString()),t&&i.append("selected_repository",t),e&&i.append("conversation_trigger",e);const{data:u}=await r.get(`/api/conversations?${i.toString()}`);return u.results}static async deleteUserConversation(t){await r.delete(`/api/conversations/${t}`)}static async createConversation(t,e,s,i,u,o,c){const n={repository:t,git_provider:e,selected_branch:u,initial_user_msg:s,suggested_task:i,conversation_instructions:o,create_microagent:c},{data:h}=await r.post("/api/conversations",n);return h}static async getConversation(t){const{data:e}=await r.get(`/api/conversations/${t}`);return e}static async startConversation(t,e){const{data:s}=await r.post(`/api/conversations/${t}/start`,e?{providers_set:e}:{});return s}static async stopConversation(t){const{data:e}=await r.post(`/api/conversations/${t}/stop`);return e}static async getSettings(){const{data:t}=await r.get("/api/settings");return t}static async saveSettings(t){return(await r.post("/api/settings",t)).status===200}static async createCheckoutSession(t){const{data:e}=await r.post("/api/billing/create-checkout-session",{amount:t});return e.redirect_url}static async createBillingSessionResponse(){const{data:t}=await r.post("/api/billing/create-customer-setup-session");return t.redirect_url}static async getBalance(){const{data:t}=await r.get("/api/billing/credits");return t.credits}static async getGitUser(){const t=await r.get("/api/user/info"),{data:e}=t;return{id:e.id,login:e.login,avatar_url:e.avatar_url,company:e.company,name:e.name,email:e.email}}static async searchGitRepositories(t,e=5,s){return(await r.get("/api/user/search/repositories",{params:{query:t,per_page:e,selected_provider:s}})).data}static async getTrajectory(t){const e=`${this.getConversationUrl(t)}/trajectory`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async logout(t){const e=t==="saas"?"/api/logout":"/api/unset-provider-tokens";await r.post(e)}static async getGitChanges(t){const e=`${this.getConversationUrl(t)}/git/changes`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getGitChangeDiff(t,e){const s=`${this.getConversationUrl(t)}/git/diff`,{data:i}=await r.get(s,{params:{path:e},headers:this.getConversationHeaders()});return i}static async retrieveUserGitRepositories(t,e=1,s=30){const{data:i}=await r.get("/api/user/repositories",{params:{selected_provider:t,sort:"pushed",page:e,per_page:s}}),u=i.length>0&&i[0].link_header?i[0].link_header:"",o=y(u);return{data:i,nextPage:o}}static async retrieveInstallationRepositories(t,e,s,i=1,u=30){const o=s[e],c=await r.get("/api/user/repositories",{params:{selected_provider:t,sort:"pushed",page:i,per_page:u,installation_id:o}}),n=c.data.length>0&&c.data[0].link_header?c.data[0].link_header:"",h=y(n);let d;return h?d=e:e+1<s.length?d=e+1:d=null,{data:c.data,nextPage:h,installationIndex:d}}static async getRepositoryBranches(t){const{data:e}=await r.get(`/api/user/repository/branches?repository=${encodeURIComponent(t)}`);return e}static async getMicroagents(t){const e=`${this.getConversationUrl(t)}/microagents`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getRepositoryMicroagents(t,e){const{data:s}=await r.get(`/api/user/repository/${t}/${e}/microagents`);return s}static async getRepositoryMicroagentContent(t,e,s){const{data:i}=await r.get(`/api/user/repository/${t}/${e}/microagents/content`,{params:{file_path:s}});return i}static async getMicroagentPrompt(t,e){const s=`${this.getConversationUrl(t)}/remember-prompt`,{data:i}=await r.get(s,{params:{event_id:e},headers:this.getConversationHeaders()});return i.prompt}static async updateConversation(t,e){const{data:s}=await r.patch(`/api/conversations/${t}`,e);return s}static async getFiles(t,e){const s=`${this.getConversationUrl(t)}/list-files`,{data:i}=await r.get(s,{params:{path:e},headers:this.getConversationHeaders()});return i}static async getFile(t,e){const s=`${this.getConversationUrl(t)}/select-file`,{data:i}=await r.get(s,{params:{file:e},headers:this.getConversationHeaders()});return i.code}static async uploadFiles(t,e){const s=new FormData;for(const o of e)s.append("files",o);const i=`${this.getConversationUrl(t)}/upload-files`;return(await r.post(i,s,{headers:{"Content-Type":"multipart/form-data",...this.getConversationHeaders()}})).data}static async getUserInstallationIds(t){const{data:e}=await r.get(`/api/user/installations?provider=${t}`);return e}}export{H as O,D as Q,R as f};
