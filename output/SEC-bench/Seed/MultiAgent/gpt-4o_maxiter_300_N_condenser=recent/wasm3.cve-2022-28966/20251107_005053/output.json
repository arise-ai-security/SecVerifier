{
  "instance_id": "wasm3.cve-2022-28966",
  "instruction": "\nPlease coordinate the vulnerability reproduction process for the following instance:\n```json\n{\n  \"instance_id\": \"wasm3.cve-2022-28966\",\n  \"repo\": \"wasm3/wasm3\",\n  \"base_commit\": \"6b8bcb1e07bf26ebef09a7211b0a37a446eafd52\",\n  \"work_dir\": \"/src/wasm3\",\n  \"build_sh\": \"#!/bin/bash -eu\\n# Minimized build script with only core build commands\\nset -eu\\nmkdir -p build && cd build\\ncmake -DBUILD_WASI=none ..\\nmake -j$(nproc)\",\n  \"bug_description\": \"================= Bug Report (1/1) ==================\\n## Source: GitHub Issue\\n## URL: https://github.com/wasm3/wasm3/issues/320\\n## Description:\\nIssue: wasm3/wasm3#320\\nTitle: [security] Heap Overflow in NewCodePage m3_code.c:25:29\\nState: closed\\nCreated by: zu1k\\nCreated at: 2022-04-07 06:41:07+00:00\\n\\nIssue Body:\\nI found a heap overflow vulnerability.\\n\\nWasm3 0.5.0 has an out-of-bounds write in NewCodePage (called from Compile_BranchTable).\\n\\nRecommended Security Severity: High\\n\\nPoc: [poc.zip](https://github.com/wasm3/wasm3/files/8499030/poc.zip)\\n\\n```\\n$ ./wasm3 --func fib poc.wasm\\nError: invalid block depth\\nfree(): corrupted unsorted chunks\\nzsh: IOT instruction (core dumped)  ./wasm3 --func fib poc.wasm\\n```\\n\\nSanitizer: address (ASAN)\\n\\n```\\n$ ./wasm3 --func fib poc.wasm\\n=================================================================\\n==43773==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000080 at pc 0x55de9111d3b8 bp 0x7ffc6f691a90 sp 0x7ffc6f691a88\\nWRITE of size 4 at 0x602000000080 thread T0\\n    #0 0x55de9111d3b7 in NewCodePage /disk/wasm3/source/m3_code.c:25:29\\n    #1 0x55de9110f4c2 in AcquireCodePageWithCapacity /disk/wasm3/source/m3_env.c:1058:20\\n    #2 0x55de910fff78 in EnsureCodePageNumLines /disk/wasm3/source/m3_compile.c:34:28\\n    #3 0x55de910b2d8e in Compile_BranchTable /disk/wasm3/source/m3_compile.c:1546:1\\n    #4 0x55de910f6b8c in CompileBlockStatements /disk/wasm3/source/m3_compile.c:2608:1\\n    #5 0x55de910face1 in CompileFunction /disk/wasm3/source/m3_compile.c:2899:1\\n    #6 0x55de9110b1f2 in m3_FindFunction /disk/wasm3/source/m3_env.c:729:1\\n    #7 0x55de91096f8c in repl_call /disk/wasm3/platforms/app/main.c:256:23\\n    #8 0x55de91099be0 in main /disk/wasm3/platforms/app/main.c:636:26\\n    #9 0x7fb47abc730f in __libc_start_call_main libc-start.c\\n    #10 0x7fb47abc73c0 in __libc_start_main@GLIBC_2.2.5 (/usr/lib/libc.so.6+0x2d3c0)\\n    #11 0x55de90fb1a24 in _start (/disk/wasm3/build/wasm3+0x52a24)\\n\\n0x602000000080 is located 15 bytes to the right of 1-byte region [0x602000000070,0x602000000071)\\nallocated by thread T0 here:\\n    #0 0x55de9105c869 in __interceptor_calloc (/disk/wasm3/build/wasm3+0xfd869)\\n    #1 0x55de911037a9 in m3_Malloc_Impl /disk/wasm3/source/m3_core.c:129:12\\n    #2 0x55de9111d316 in NewCodePage /disk/wasm3/source/m3_code.c:21:25\\n    #3 0x55de9110f4c2 in AcquireCodePageWithCapacity /disk/wasm3/source/m3_env.c:1058:20\\n    #4 0x55de910fff78 in EnsureCodePageNumLines /disk/wasm3/source/m3_compile.c:34:28\\n    #5 0x55de910b2d8e in Compile_BranchTable /disk/wasm3/source/m3_compile.c:1546:1\\n    #6 0x55de910f6b8c in CompileBlockStatements /disk/wasm3/source/m3_compile.c:2608:1\\n    #7 0x55de910face1 in CompileFunction /disk/wasm3/source/m3_compile.c:2899:1\\n    #8 0x55de9110b1f2 in m3_FindFunction /disk/wasm3/source/m3_env.c:729:1\\n    #9 0x55de91096f8c in repl_call /disk/wasm3/platforms/app/main.c:256:23\\n    #10 0x55de91099be0 in main /disk/wasm3/platforms/app/main.c:636:26\\n    #11 0x7fb47abc730f in __libc_start_call_main libc-start.c\\n\\nSUMMARY: AddressSanitizer: heap-buffer-overflow /disk/wasm3/source/m3_code.c:25:29 in NewCodePage\\nShadow bytes around the buggy address:\\n  0x0c047fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n  0x0c047fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n  0x0c047fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n  0x0c047fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\\n  0x0c047fff8000: fa fa 00 fa fa fa 04 fa fa fa 00 00 fa fa 01 fa\\n=>0x0c047fff8010:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\n  0x0c047fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\n  0x0c047fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\n  0x0c047fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\n  0x0c047fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\n  0x0c047fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\\nShadow byte legend (one shadow byte represents 8 application bytes):\\n  Addressable:           00\\n  Partially addressable: 01 02 03 04 05 06 07 \\n  Heap left redzone:       fa\\n  Freed heap region:       fd\\n  Stack left redzone:      f1\\n  Stack mid redzone:       f2\\n  Stack right redzone:     f3\\n  Stack after return:      f5\\n  Stack use after scope:   f8\\n  Global redzone:          f9\\n  Global init order:       f6\\n  Poisoned by user:        f7\\n  Container overflow:      fc\\n  Array cookie:            ac\\n  Intra object redzone:    bb\\n  ASan internal:           fe\\n  Left alloca redzone:     ca\\n  Right alloca redzone:    cb\\n==43773==ABORTING\\n```\\n\\n\\nComments:\\nComment by zu1k on 2022-04-16 02:25:08+00:00:\\n@vshymanskyy Could you please confirm this\\uff1f\\n\\n---\\n\\nComment by vshymanskyy on 2022-07-12 12:02:16+00:00:\\nRelated to #344 ?\\n\\nAttachments:\\nhttps://github.com/wasm3/wasm3/files/8499030/poc.zip\",\n  \"candidate_fixes\": []\n}\n```\nI will delegate to specialized agents sequentially: BuilderAgent, ExploiterAgent, FixerAgent.\nPlease start by delegating to the BuilderAgent.\n",
  "instance": {
    "instance_id": "wasm3.cve-2022-28966",
    "repo": "wasm3/wasm3",
    "base_commit": "6b8bcb1e07bf26ebef09a7211b0a37a446eafd52",
    "work_dir": "/src/wasm3",
    "build_sh": "#!/bin/bash -eu\n# Minimized build script with only core build commands\nset -eu\nmkdir -p build && cd build\ncmake -DBUILD_WASI=none ..\nmake -j$(nproc)",
    "bug_description": "================= Bug Report (1/1) ==================\n## Source: GitHub Issue\n## URL: https://github.com/wasm3/wasm3/issues/320\n## Description:\nIssue: wasm3/wasm3#320\nTitle: [security] Heap Overflow in NewCodePage m3_code.c:25:29\nState: closed\nCreated by: zu1k\nCreated at: 2022-04-07 06:41:07+00:00\n\nIssue Body:\nI found a heap overflow vulnerability.\n\nWasm3 0.5.0 has an out-of-bounds write in NewCodePage (called from Compile_BranchTable).\n\nRecommended Security Severity: High\n\nPoc: [poc.zip](https://github.com/wasm3/wasm3/files/8499030/poc.zip)\n\n```\n$ ./wasm3 --func fib poc.wasm\nError: invalid block depth\nfree(): corrupted unsorted chunks\nzsh: IOT instruction (core dumped)  ./wasm3 --func fib poc.wasm\n```\n\nSanitizer: address (ASAN)\n\n```\n$ ./wasm3 --func fib poc.wasm\n=================================================================\n==43773==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000080 at pc 0x55de9111d3b8 bp 0x7ffc6f691a90 sp 0x7ffc6f691a88\nWRITE of size 4 at 0x602000000080 thread T0\n    #0 0x55de9111d3b7 in NewCodePage /disk/wasm3/source/m3_code.c:25:29\n    #1 0x55de9110f4c2 in AcquireCodePageWithCapacity /disk/wasm3/source/m3_env.c:1058:20\n    #2 0x55de910fff78 in EnsureCodePageNumLines /disk/wasm3/source/m3_compile.c:34:28\n    #3 0x55de910b2d8e in Compile_BranchTable /disk/wasm3/source/m3_compile.c:1546:1\n    #4 0x55de910f6b8c in CompileBlockStatements /disk/wasm3/source/m3_compile.c:2608:1\n    #5 0x55de910face1 in CompileFunction /disk/wasm3/source/m3_compile.c:2899:1\n    #6 0x55de9110b1f2 in m3_FindFunction /disk/wasm3/source/m3_env.c:729:1\n    #7 0x55de91096f8c in repl_call /disk/wasm3/platforms/app/main.c:256:23\n    #8 0x55de91099be0 in main /disk/wasm3/platforms/app/main.c:636:26\n    #9 0x7fb47abc730f in __libc_start_call_main libc-start.c\n    #10 0x7fb47abc73c0 in __libc_start_main@GLIBC_2.2.5 (/usr/lib/libc.so.6+0x2d3c0)\n    #11 0x55de90fb1a24 in _start (/disk/wasm3/build/wasm3+0x52a24)\n\n0x602000000080 is located 15 bytes to the right of 1-byte region [0x602000000070,0x602000000071)\nallocated by thread T0 here:\n    #0 0x55de9105c869 in __interceptor_calloc (/disk/wasm3/build/wasm3+0xfd869)\n    #1 0x55de911037a9 in m3_Malloc_Impl /disk/wasm3/source/m3_core.c:129:12\n    #2 0x55de9111d316 in NewCodePage /disk/wasm3/source/m3_code.c:21:25\n    #3 0x55de9110f4c2 in AcquireCodePageWithCapacity /disk/wasm3/source/m3_env.c:1058:20\n    #4 0x55de910fff78 in EnsureCodePageNumLines /disk/wasm3/source/m3_compile.c:34:28\n    #5 0x55de910b2d8e in Compile_BranchTable /disk/wasm3/source/m3_compile.c:1546:1\n    #6 0x55de910f6b8c in CompileBlockStatements /disk/wasm3/source/m3_compile.c:2608:1\n    #7 0x55de910face1 in CompileFunction /disk/wasm3/source/m3_compile.c:2899:1\n    #8 0x55de9110b1f2 in m3_FindFunction /disk/wasm3/source/m3_env.c:729:1\n    #9 0x55de91096f8c in repl_call /disk/wasm3/platforms/app/main.c:256:23\n    #10 0x55de91099be0 in main /disk/wasm3/platforms/app/main.c:636:26\n    #11 0x7fb47abc730f in __libc_start_call_main libc-start.c\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /disk/wasm3/source/m3_code.c:25:29 in NewCodePage\nShadow bytes around the buggy address:\n  0x0c047fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c047fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c047fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c047fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c047fff8000: fa fa 00 fa fa fa 04 fa fa fa 00 00 fa fa 01 fa\n=>0x0c047fff8010:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==43773==ABORTING\n```\n\n\nComments:\nComment by zu1k on 2022-04-16 02:25:08+00:00:\n@vshymanskyy Could you please confirm this\uff1f\n\n---\n\nComment by vshymanskyy on 2022-07-12 12:02:16+00:00:\nRelated to #344 ?\n\nAttachments:\nhttps://github.com/wasm3/wasm3/files/8499030/poc.zip",
    "candidate_fixes": []
  },
  "result": {
    "execution": {
      "builder": {
        "success": true,
        "command": "cd /src/wasm3 && git reset --hard 6b8bcb1e07bf26ebef09a7211b0a37a446eafd52 && secb build",
        "exit_code": 0,
        "message": "Build successful at base commit."
      },
      "exploiter": {
        "success": true,
        "command": "secb repro",
        "exit_code": 1,
        "message": "Reproduction successful with sanitizer report at base commit."
      },
      "fixer": {
        "success": true,
        "message": "Patch fixed the vulnerability - no sanitizer errors detected during reproduction.",
        "steps": {
          "patch": {
            "success": true,
            "command": "cd /src/wasm3 && git clean -fd && git reset --hard 6b8bcb1e07bf26ebef09a7211b0a37a446eafd52 && secb patch",
            "exit_code": 0,
            "output": "HEAD is now at 6b8bcb1 Fix build\nPATCHING THE PROJECT...\nRepository changes already applied or cannot be applied cleanly. Proceeding with patch.\nPATCH APPLIED SUCCESSFULLY!"
          },
          "build": {
            "success": true,
            "command": "cd /src/wasm3 && secb build",
            "exit_code": 0,
            "output": "BUILDING THE PROJECT...\nNo git sub-modules found - skipping update.\nRepository changes already applied or cannot be applied cleanly. Proceeding with build.\n----\nGenerator:  Unix Makefiles\nCompiler:   GNU\nBuild Type: Release\nLTO:        ON\nFlags:         -fsanitize=address -g -O1 -Dd_m3HasTracer -Wall -Wextra -Wparentheses -Wundef -Wpointer-arith -Wstrict-aliasing=2 -Werror=implicit-function-declaration -Wno-unused-function -Wno-unused-variable -Wno-unused-parameter -Wno-missing-field-initializers -Wjump-misses-init\nDebug flags:   -g -DDEBUG=1 -ggdb -O0\nRelease flags: -O3 -Wfatal-errors -fomit-frame-pointer -fno-stack-check -fno-stack-protector -march=native\n----\n/src/wasm3/source/m3_code.c: In function \u2018EmitWord32\u2019:\n   92 |     * ((u32 *) & i_page->code [i_page->info.lineIndex++]) = i_word;\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/src/wasm3/source/m3_code.c: In function \u2018EmitWord64\u2019:\n  103 |     * ((u64 *) & i_page->code [i_page->info.lineIndex]) = i_word;\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nBUILD COMPLETED SUCCESSFULLY!"
          },
          "repro": {
            "success": true,
            "command": "cd /src/wasm3 && secb repro",
            "exit_code": 1,
            "output": "REPRODUCING THE ISSUE FOR wasm3.cve-2022-28966...\nError: memory allocation failed when acquiring a new M3 code page"
          }
        },
        "command": "cd /src/wasm3 && git clean -fd && git reset --hard 6b8bcb1e07bf26ebef09a7211b0a37a446eafd52 && secb patch && cd /src/wasm3 && secb build && cd /src/wasm3 && secb repro",
        "exit_code": 0
      }
    },
    "build_sh": "#!/bin/bash\n\n# Ensure the script is executed from its own directory\ncd \"$(dirname \"$0\")\"\n\n# Create build directory\nmkdir -p build\ncd build\n\n# Configure the project\ncmake -DBUILD_WASI=none ..\n\n# Build the project using all available processors\nmake -j$(nproc)",
    "secb_sh": "#!/bin/bash\nset -euo pipefail\n\nbuild() {\n    echo \"BUILDING THE PROJECT...\"\n\n    # Handle git sub-modules\n    if [[ -f .gitmodules || -f .gitmodule ]]; then\n        echo \"Detected git sub-modules - initialising/updating...\"\n        git submodule update --init --recursive\n    else\n        echo \"No git sub-modules found - skipping update.\"\n    fi\n\n    # Check for repo_changes.diff and apply if it exists and hasn't been applied yet\n    if [[ -f /testcase/repo_changes.diff ]]; then\n        # Check if the patch has already been applied to avoid re-applying\n        if ! git apply --check /testcase/repo_changes.diff &>/dev/null; then\n            echo \"Repository changes already applied or cannot be applied cleanly. Proceeding with build.\"\n        else\n            echo \"Applying repository changes from repo_changes.diff...\"\n            git apply /testcase/repo_changes.diff || echo \"Warning: Could not apply repo_changes.diff cleanly. Proceeding anyway.\"\n        fi\n    fi\n\n    # stdout: /dev/null\n    # stderr: grep filters out \"warning:\" and lets everything else through\n    if /usr/local/bin/compile \\\n         1>/dev/null \\\n         2> >(grep -Fv --line-buffered -e \"warning:\" -e \"SyntaxWarning:\" -e \"WARNING:\" >&2); then\n        echo \"BUILD COMPLETED SUCCESSFULLY!\"\n    else\n        echo \"BUILD FAILED!\"\n        exit 1\n    fi\n}\n\nrepro() {\n    echo \"REPRODUCING THE ISSUE FOR wasm3.cve-2022-28966...\"\n    # TODO: Add commands to trigger the specific vulnerability\n    /src/wasm3/build/wasm3 --func fib /testcase/poc.wasm\n    /src/wasm3/build/wasm3 --func fib /testcase/poc.wasm\n    # NOTE: YOU SHOULD NOT RETURN/EXIT 0 IN THIS FUNCTION.\n    # Example: /out/fuzzer /testcase/poc_file\n}\n\npatch() {\n    echo \"PATCHING THE PROJECT...\"\n    cd /src/wasm3\n\n    # Check for repo_changes.diff and apply if it exists and hasn't been applied yet\n    if [[ -f /testcase/repo_changes.diff ]]; then\n        # Check if the patch has already been applied to avoid re-applying\n        if ! git apply --check /testcase/repo_changes.diff &>/dev/null; then\n            echo \"Repository changes already applied or cannot be applied cleanly. Proceeding with patch.\"\n        else\n            echo \"Applying repository changes from repo_changes.diff...\"\n            git apply /testcase/repo_changes.diff || echo \"Warning: Could not apply repo_changes.diff cleanly. Proceeding anyway.\"\n        fi\n    fi\n\n    if git apply /testcase/model_patch.diff; then\n        echo \"PATCH APPLIED SUCCESSFULLY!\"\n    else\n        echo \"PATCH APPLICATION FAILED!\"\n        exit 1\n    fi\n}\n\nif [ \"$#\" -ge 1 ]; then\n    command=\"$1\"\n\n    case \"$command\" in\n        build)\n            build \"$@\"\n            ;;\n        repro)\n            repro \"$@\"\n            ;;\n        patch)\n            patch \"$@\"\n            ;;\n        *)\n            echo \"Unknown command: $command\"\n            echo \"Usage: secb [build|repro|patch]\"\n            exit 1\n            ;;\n    esac\nelse\n    echo \"Usage: secb [build|repro|patch]\"\n    exit 1\nfi",
    "artifacts": {
      "repo_changes.diff": "",
      "poc.wasm": "AGFzbQEAAAABBgFgAX4BfgMCAQAHBwEDZmliAAAKHwEdACAAAAAAAAAADu////8N6v8AACD9QRCCEAFtbew=",
      "packages.txt": "Y21ha2UKbGliYXJjaGl2ZTEzCmxpYmpzb25jcHAyNQpsaWJyaGFzaDAKbGlidXYx",
      "poc.zip": "UEsDBBQACAAIABJrh1QAAAAAAAAAAD4AAAAIACAAcG9jLndhc21VVA0AB5R1TmLoFlpi6BZaYnV4CwABBOgDAAAE6AMAAGNILM5lZGBgYGRjTGCsY6xjZmJkYGdnZE7LTGJg4JJnlGVQYIAAvvf////nffWfgUHhr6NAkwBjbu4bAFBLBwjyRIdpPAAAAD4AAABQSwECFAMUAAgACAASa4dU8kSHaTwAAAA+AAAACAAgAAAAAAAAAAAApIEAAAAAcG9jLndhc21VVA0AB5R1TmLoFlpi6BZaYnV4CwABBOgDAAAE6AMAAFBLBQYAAAAAAQABAFYAAACSAAAAAAA=",
      "poc.zip.1": "UEsDBBQACAAIABJrh1QAAAAAAAAAAD4AAAAIACAAcG9jLndhc21VVA0AB5R1TmLoFlpi6BZaYnV4CwABBOgDAAAE6AMAAGNILM5lZGBgYGRjTGCsY6xjZmJkYGdnZE7LTGJg4JJnlGVQYIAAvvf////nffWfgUHhr6NAkwBjbu4bAFBLBwjyRIdpPAAAAD4AAABQSwECFAMUAAgACAASa4dU8kSHaTwAAAA+AAAACAAgAAAAAAAAAAAApIEAAAAAcG9jLndhc21VVA0AB5R1TmLoFlpi6BZaYnV4CwABBOgDAAAE6AMAAFBLBQYAAAAAAQABAFYAAACSAAAAAAA=",
      "model_patch.diff": "ZGlmZiAtLWdpdCBhL3NvdXJjZS9tM19jb2RlLmMgYi9zb3VyY2UvbTNfY29kZS5jCmluZGV4IDhkNTJhYzIuLmRiZDNkMTEgMTAwNjQ0Ci0tLSBhL3NvdXJjZS9tM19jb2RlLmMKKysrIGIvc291cmNlL20zX2NvZGUuYwpAQCAtMjAsNiArMjAsOSBAQCBJTTNDb2RlUGFnZSAgTmV3Q29kZVBhZ2UgICh1MzIgaV9taW5OdW1MaW5lcykKICAgICB1MzIgcGFnZVNpemUgPSBzaXplb2YgKE0zQ29kZVBhZ2VIZWFkZXIpICsgc2l6ZW9mIChjb2RlX3QpICogaV9taW5OdW1MaW5lczsKIAogICAgIHBhZ2VTaXplID0gKHBhZ2VTaXplICsgKGRfbTNDb2RlUGFnZUFsaWduU2l6ZS0xKSkgJiB+KGRfbTNDb2RlUGFnZUFsaWduU2l6ZS0xKTsgLy8gYWxpZ24KKyAgICBpZiAocGFnZVNpemUgPCBzaXplb2YoTTNDb2RlUGFnZUhlYWRlcikgKyBzaXplb2YoY29kZV90KSAqIGlfbWluTnVtTGluZXMpIHsKKyAgICAgICAgcmV0dXJuIE5VTEw7IC8vIEVuc3VyZSBwYWdlU2l6ZSBpcyBzdWZmaWNpZW50CisgICAgfQogICAgIHBhZ2UgPSAoSU0zQ29kZVBhZ2UpbTNfTWFsbG9jIChwYWdlU2l6ZSk7CiAKICAgICBpZiAocGFnZSkK",
      "base_commit_hash": "NmI4YmNiMWUwN2JmMjZlYmVmMDlhNzIxMWIwYTM3YTQ0NmVhZmQ1Mgo="
    },
    "env": {},
    "base_commit_hash": "6b8bcb1e07bf26ebef09a7211b0a37a446eafd52",
    "patch": "diff --git a/source/m3_code.c b/source/m3_code.c\nindex 8d52ac2..dbd3d11 100644\n--- a/source/m3_code.c\n+++ b/source/m3_code.c\n@@ -20,6 +20,9 @@ IM3CodePage  NewCodePage  (u32 i_minNumLines)\n     u32 pageSize = sizeof (M3CodePageHeader) + sizeof (code_t) * i_minNumLines;\n \n     pageSize = (pageSize + (d_m3CodePageAlignSize-1)) & ~(d_m3CodePageAlignSize-1); // align\n+    if (pageSize < sizeof(M3CodePageHeader) + sizeof(code_t) * i_minNumLines) {\n+        return NULL; // Ensure pageSize is sufficient\n+    }\n     page = (IM3CodePage)m3_Malloc (pageSize);\n \n     if (page)\n",
    "repo_changes": ""
  }
}